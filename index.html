<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Yearly Budget App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .controls {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn.success {
            background: #27ae60;
        }

        .btn.success:hover {
            background: #229954;
        }

        .btn.danger {
            background: #e74c3c;
        }

        .btn.danger:hover {
            background: #c0392b;
        }

        .content {
            padding: 40px;
        }

        .budget-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .overview-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid;
            transition: transform 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-5px);
        }

        .overview-card.income {
            border-left-color: #27ae60;
        }

        .overview-card.expenses {
            border-left-color: #e74c3c;
        }

        .overview-card.savings {
            border-left-color: #3498db;
        }

        .overview-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .overview-card .amount {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .overview-card.income .amount {
            color: #27ae60;
        }

        .overview-card.expenses .amount {
            color: #e74c3c;
        }

        .overview-card.savings .amount {
            color: #3498db;
        }

        .budget-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .table-header {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .add-row-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .add-row-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .editable {
            background: transparent;
            border: none;
            font-family: inherit;
            font-size: inherit;
            width: 100%;
            padding: 5px;
            border-radius: 4px;
        }

        .editable:focus {
            outline: 2px solid #3498db;
            background: #fff;
        }

        .editable.currency {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .total-row {
            background: #2c3e50 !important;
            color: white !important;
            font-weight: bold;
        }

        .total-row td {
            border-color: #34495e;
        }

        .amount-cell {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .positive {
            color: #27ae60;
        }

        .negative {
            color: #e74c3c;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .progress-bar {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .instructions {
            background: #e8f5e8;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .instructions h3 {
            color: #155724;
            margin-bottom: 15px;
        }

        .instructions ul {
            color: #155724;
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .controls {
                justify-content: center;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Interactive Budget Planner 2025</h1>
            <p>Your personal finance management tool - all data saved locally</p>
        </div>

        <div class="controls">
            <button class="btn success" onclick="exportData()">üì§ Export Data</button>
            <button class="btn" onclick="importData()">üì• Import Data</button>
            <button class="btn" onclick="clearData()">üîÑ Reset Data</button>
            <button class="btn danger" onclick="clearAllData()">üóëÔ∏è Clear All</button>
        </div>

        <div class="content">
            <div class="budget-overview">
                <div class="overview-card income">
                    <h3>Annual Income</h3>
                    <div class="amount" id="totalIncome">$0</div>
                    <div>Monthly Average: <span id="monthlyIncome">$0</span></div>
                </div>
                <div class="overview-card expenses">
                    <h3>Annual Expenses</h3>
                    <div class="amount" id="totalExpenses">$0</div>
                    <div>Monthly Average: <span id="monthlyExpenses">$0</span></div>
                </div>
                <div class="overview-card savings">
                    <h3>Net Result</h3>
                    <div class="amount" id="netSavings">$0</div>
                    <div>Savings Rate: <span id="savingsRate">0%</span></div>
                </div>
            </div>

            <div class="budget-table">
                <div class="table-header">
                    üí∞ Income Sources
                    <button class="add-row-btn" onclick="addIncomeRow()">+ Add Income</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Income Source</th>
                            <th>Monthly Amount</th>
                            <th>Annual Total</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="incomeTable">
                    </tbody>
                </table>
            </div>

            <div class="budget-table">
                <div class="table-header">
                    üè† Fixed Expenses
                    <button class="add-row-btn" onclick="addExpenseRow('fixed')">+ Add Fixed Expense</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Expense Category</th>
                            <th>Monthly Amount</th>
                            <th>Annual Total</th>
                            <th>% of Income</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="fixedExpenseTable">
                    </tbody>
                </table>
            </div>

            <div class="budget-table">
                <div class="table-header">
                    üõí Variable Expenses
                    <button class="add-row-btn" onclick="addExpenseRow('variable')">+ Add Variable Expense</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Expense Category</th>
                            <th>Monthly Budget</th>
                            <th>Annual Budget</th>
                            <th>% of Income</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="variableExpenseTable">
                    </tbody>
                </table>
            </div>

            <div class="budget-table">
                <div class="table-header">
                    üí≥ Savings & Investments
                    <button class="add-row-btn" onclick="addSavingsRow()">+ Add Savings Goal</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Savings Goal</th>
                            <th>Monthly Target</th>
                            <th>Annual Target</th>
                            <th>Current Saved</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="savingsTable">
                    </tbody>
                </table>
            </div>

            <div class="budget-overview">
                <div class="overview-card">
                    <h3>üìà Budget Summary</h3>
                    <div style="margin: 15px 0;" id="budgetSummary">
                        <div><strong>Total Income:</strong> <span class="positive" id="summaryIncome">$0</span></div>
                        <div><strong>Total Expenses:</strong> <span class="negative" id="summaryExpenses">$0</span></div>
                        <div><strong>Total Savings Goals:</strong> <span class="positive" id="summarySavings">$0</span></div>
                        <div><strong>Remaining:</strong> <span id="summaryRemaining">$0</span></div>
                    </div>
                </div>
                
                <div class="overview-card">
                    <h3>üéØ Financial Health</h3>
                    <div style="margin: 15px 0;" id="financialHealth">
                        <div><strong>Savings Rate:</strong> <span id="healthSavingsRate">0%</span></div>
                        <div><strong>Expense Ratio:</strong> <span id="healthExpenseRatio">0%</span></div>
                        <div><strong>Monthly Surplus:</strong> <span id="healthSurplus">$0</span></div>
                        <div><strong>Status:</strong> <span id="healthStatus">Getting Started</span></div>
                    </div>
                </div>
            </div>

            <div class="instructions">
                <h3>üöÄ How to Use Your Interactive Budget App</h3>
                <ul>
                    <li><strong>Click to Edit:</strong> Click on any amount or text field to edit your budget items</li>
                    <li><strong>Add Items:</strong> Use the "+ Add" buttons to create new income, expense, or savings entries</li>
                    <li><strong>Auto-Calculate:</strong> Annual totals and percentages update automatically as you type</li>
                    <li><strong>Save Your Work:</strong> Your data is automatically saved in your browser</li>
                    <li><strong>Export Data:</strong> Download your budget as a JSON file for backup</li>
                    <li><strong>Import Data:</strong> Upload a previously exported file to restore your budget</li>
                    <li><strong>Works Offline:</strong> No internet required - everything runs in your browser</li>
                    <li><strong>Mobile Friendly:</strong> Use on your phone or tablet for quick updates</li>
                </ul>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" style="display: none;" accept=".json" onchange="handleImport(event)">

    <script>
        // Budget data structure
        let budgetData = {
            income: [],
            fixedExpenses: [],
            variableExpenses: [],
            savings: []
        };

        // Load data from localStorage on page load
        function loadData() {
            const saved = localStorage.getItem('budgetData');
            if (saved) {
                budgetData = JSON.parse(saved);
            } else {
                // Initialize with sample data
                budgetData = {
                    income: [
                        { name: 'Primary Salary', monthly: 5000, notes: 'Full-time position' },
                        { name: 'Side Business', monthly: 1000, notes: 'Freelance consulting' }
                    ],
                    fixedExpenses: [
                        { name: 'Rent/Mortgage', monthly: 1500 },
                        { name: 'Insurance', monthly: 400 },
                        { name: 'Utilities', monthly: 200 }
                    ],
                    variableExpenses: [
                        { name: 'Groceries', monthly: 600 },
                        { name: 'Transportation', monthly: 300 },
                        { name: 'Entertainment', monthly: 400 }
                    ],
                    savings: [
                        { name: 'Emergency Fund', monthly: 400, current: 3120 },
                        { name: 'Retirement', monthly: 650, current: 3120 }
                    ]
                };
                saveData();
            }
            renderAll();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('budgetData', JSON.stringify(budgetData));
            updateTotals();
        }

        // Render all tables
        function renderAll() {
            renderIncomeTable();
            renderExpenseTable('fixed');
            renderExpenseTable('variable');
            renderSavingsTable();
            updateTotals();
        }

        // Render income table
        function renderIncomeTable() {
            const tbody = document.getElementById('incomeTable');
            tbody.innerHTML = '';
            
            budgetData.income.forEach((item, index) => {
                const row = createIncomeRow(item, index);
                tbody.appendChild(row);
            });
            
            // Add total row
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td><strong>TOTAL INCOME</strong></td>
                <td class="amount-cell"><strong>$${getTotalMonthlyIncome().toLocaleString()}</strong></td>
                <td class="amount-cell"><strong>$${(getTotalMonthlyIncome() * 12).toLocaleString()}</strong></td>
                <td></td>
                <td></td>
            `;
            tbody.appendChild(totalRow);
        }

        // Create income row
        function createIncomeRow(item, index) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="editable" value="${item.name}" onchange="updateIncome(${index}, 'name', this.value)"></td>
                <td class="amount-cell">$<input type="number" class="editable currency" value="${item.monthly}" onchange="updateIncome(${index}, 'monthly', parseFloat(this.value) || 0)"></td>
                <td class="amount-cell positive">$${(item.monthly * 12).toLocaleString()}</td>
                <td><input type="text" class="editable" value="${item.notes || ''}" onchange="updateIncome(${index}, 'notes', this.value)"></td>
                <td><button class="delete-btn" onclick="deleteIncome(${index})">Delete</button></td>
            `;
            return row;
        }

        // Update income item
        function updateIncome(index, field, value) {
            budgetData.income[index][field] = value;
            saveData();
            renderIncomeTable();
        }

        // Delete income item
        function deleteIncome(index) {
            budgetData.income.splice(index, 1);
            saveData();
            renderIncomeTable();
        }

        // Add income row
        function addIncomeRow() {
            budgetData.income.push({ name: 'New Income Source', monthly: 0, notes: '' });
            saveData();
            renderIncomeTable();
        }

        // Render expense table
        function renderExpenseTable(type) {
            const tbody = document.getElementById(type + 'ExpenseTable');
            tbody.innerHTML = '';
            
            const expenses = budgetData[type + 'Expenses'];
            expenses.forEach((item, index) => {
                const row = createExpenseRow(item, index, type);
                tbody.appendChild(row);
            });
            
            // Add total row
            const totalMonthly = getTotalMonthlyExpenses(type);
            const totalAnnual = totalMonthly * 12;
            const totalIncome = getTotalMonthlyIncome() * 12;
            const percentage = totalIncome > 0 ? (totalAnnual / totalIncome * 100).toFixed(1) : 0;
            
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td><strong>TOTAL ${type.toUpperCase()}</strong></td>
                <td class="amount-cell"><strong>$${totalMonthly.toLocaleString()}</strong></td>
                <td class="amount-cell"><strong>$${totalAnnual.toLocaleString()}</strong></td>
                <td><strong>${percentage}%</strong></td>
                <td></td>
            `;
            tbody.appendChild(totalRow);
        }

        // Create expense row
        function createExpenseRow(item, index, type) {
            const totalIncome = getTotalMonthlyIncome() * 12;
            const annualAmount = item.monthly * 12;
            const percentage = totalIncome > 0 ? (annualAmount / totalIncome * 100).toFixed(1) : 0;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="editable" value="${item.name}" onchange="updateExpense('${type}', ${index}, 'name', this.value)"></td>
                <td class="amount-cell">$<input type="number" class="editable currency" value="${item.monthly}" onchange="updateExpense('${type}', ${index}, 'monthly', parseFloat(this.value) || 0)"></td>
                <td class="amount-cell negative">$${annualAmount.toLocaleString()}</td>
                <td>${percentage}%</td>
                <td><button class="delete-btn" onclick="deleteExpense('${type}', ${index})">Delete</button></td>
            `;
            return row;
        }

        // Update expense item
        function updateExpense(type, index, field, value) {
            budgetData[type + 'Expenses'][index][field] = value;
            saveData();
            renderExpenseTable(type);
        }

        // Delete expense item
        function deleteExpense(type, index) {
            budgetData[type + 'Expenses'].splice(index, 1);
            saveData();
            renderExpenseTable(type);
        }

        // Add expense row
        function addExpenseRow(type) {
            budgetData[type + 'Expenses'].push({ name: 'New Expense', monthly: 0 });
            saveData();
            renderExpenseTable(type);
        }

        // Render savings table
        function renderSavingsTable() {
            const tbody = document.getElementById('savingsTable');
            tbody.innerHTML = '';
            
            budgetData.savings.forEach((item, index) => {
                const row = createSavingsRow(item, index);
                tbody.appendChild(row);
            });
            
            // Add total row
            const totalMonthly = getTotalMonthlySavings();
            const totalAnnual = totalMonthly * 12;
            
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td><strong>TOTAL SAVINGS</strong></td>
                <td class="amount-cell"><strong>$${totalMonthly.toLocaleString()}</strong></td>
                <td class="amount-cell"><strong>$${totalAnnual.toLocaleString()}</strong></td>
                <td><strong>$${getTotalCurrentSavings().toLocaleString()}</strong></td>
                <td></td>
            `;
            tbody.appendChild(totalRow);
        }

        // Create savings row
        function createSavingsRow(item, index) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="editable" value="${item.name}" onchange="updateSavings(${index}, 'name', this.value)"></td>
                <td class="amount-cell">$<input type="number" class="editable currency" value="${item.monthly}" onchange="updateSavings(${index}, 'monthly', parseFloat(this.value) || 0)"></td>
                <td class="amount-cell positive">$${(item.monthly * 12).toLocaleString()}</td>
                <td class="amount-cell">$<input type="number" class="editable currency" value="${item.current || 0}" onchange="updateSavings(${index}, 'current', parseFloat(this.value) || 0)"></td>
                <td><button class="delete-btn" onclick="deleteSavings(${index})">Delete</button></td>
            `;
            return row;
        }

        // Update savings item
        function updateSavings(index, field, value) {
            budgetData.savings[index][field] = value;
            saveData();
            renderSavingsTable();
        }

        // Delete savings item
        function deleteSavings(index) {
            budgetData.savings.splice(index, 1);
            saveData();
            renderSavingsTable();
        }

        // Add savings row
        function addSavingsRow() {
            budgetData.savings.push({ name: 'New Savings Goal', monthly: 0, current: 0 });
            saveData();
            renderSavingsTable();
        }

        // Calculate totals
        function getTotalMonthlyIncome() {
            return budgetData.income.reduce((sum, item) => sum + (item.monthly || 0), 0);
        }

        function getTotalMonthlyExpenses(type) {
            return budgetData[type + 'Expenses'].reduce((sum, item) => sum + (item.monthly || 0), 0);
        }

        function getTotalMonthlySavings() {
            return budgetData.savings.reduce((sum, item) => sum + (item.monthly || 0), 0);
        }

        function getTotalCurrentSavings() {
            return budgetData.savings.reduce((sum, item) => sum + (item.current || 0), 0);
        }

        // Update totals display
        function updateTotals() {
            const monthlyIncome = getTotalMonthlyIncome();
            const annualIncome = monthlyIncome * 12;
            const monthlyFixedExpenses = getTotalMonthlyExpenses('fixed');
            const monthlyVariableExpenses = getTotalMonthlyExpenses('variable');
            const totalMonthlyExpenses = monthlyFixedExpenses + monthlyVariableExpenses;
            const totalAnnualExpenses = totalMonthlyExpenses * 12;
            const monthlySavings = getTotalMonthlySavings();
            const annualSavings = monthlySavings * 12;
            const netAmount = annualIncome - totalAnnualExpenses - annualSavings;
            const savingsRate = annualIncome > 0 ? (annualSavings / annualIncome * 100) : 0;
            
            // Update overview cards
            document.getElementById('totalIncome').textContent = `$${annualIncome.toLocaleString()}`;
            document.getElementById('monthlyIncome').textContent = `$${monthlyIncome.toLocaleString()}`;
            document.getElementById('totalExpenses').textContent = `$${totalAnnualExpenses.toLocaleString()}`;
            document.getElementById('monthlyExpenses').textContent = `$${totalMonthlyExpenses.toLocaleString()}`;
            document.getElementById('netSavings').textContent = `$${netAmount.toLocaleString()}`;
            document.getElementById('savingsRate').textContent = `${savingsRate.toFixed(1)}%`;
            
            // Update summary
            document.getElementById('summaryIncome').textContent = `$${annualIncome.toLocaleString()}`;
            document.getElementById('summaryExpenses').textContent = `$${totalAnnualExpenses.toLocaleString()}`;
            document.getElementById('summarySavings').textContent = `$${annualSavings.toLocaleString()}`;
            document.getElementById('summaryRemaining').textContent = `$${netAmount.toLocaleString()}`;
            document.getElementById('summaryRemaining').className = netAmount >= 0 ? 'positive' : 'negative';
            
            // Update health indicators
            document.getElementById('healthSavingsRate').textContent = `${savingsRate.toFixed(1)}%`;
            document.getElementById('healthExpenseRatio').textContent = `${annualIncome > 0 ? (totalAnnualExpenses / annualIncome * 100).toFixed(1) : 0}%`;
            document.getElementById('healthSurplus').textContent = `${(netAmount / 12).toLocaleString()}`;
            
            // Update health status
            let healthStatus = 'Getting Started';
            if (savingsRate >= 20) {
                healthStatus = 'Excellent ‚úÖ';
            } else if (savingsRate >= 10) {
                healthStatus = 'Good ‚úÖ';
            } else if (savingsRate >= 5) {
                healthStatus = 'Fair ‚ö†Ô∏è';
            } else if (netAmount < 0) {
                healthStatus = 'Needs Attention ‚ùå';
            }
            document.getElementById('healthStatus').textContent = healthStatus;
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(budgetData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `budget_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Import data
        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (importedData.income && importedData.fixedExpenses && 
                        importedData.variableExpenses && importedData.savings) {
                        budgetData = importedData;
                        saveData();
                        renderAll();
                        alert('Data imported successfully!');
                    } else {
                        alert('Invalid file format. Please select a valid budget backup file.');
                    }
                } catch (error) {
                    alert('Error reading file. Please ensure it\'s a valid JSON file.');
                }
            };
            reader.readAsText(file);
        }

        // Reset to sample data
        function clearData() {
            if (confirm('Reset to sample data? Your current data will be lost.')) {
                budgetData = {
                    income: [
                        { name: 'Primary Salary', monthly: 5000, notes: 'Full-time position' },
                        { name: 'Side Business', monthly: 1000, notes: 'Freelance consulting' }
                    ],
                    fixedExpenses: [
                        { name: 'Rent/Mortgage', monthly: 1500 },
                        { name: 'Insurance', monthly: 400 },
                        { name: 'Utilities', monthly: 200 }
                    ],
                    variableExpenses: [
                        { name: 'Groceries', monthly: 600 },
                        { name: 'Transportation', monthly: 300 },
                        { name: 'Entertainment', monthly: 400 }
                    ],
                    savings: [
                        { name: 'Emergency Fund', monthly: 400, current: 3120 },
                        { name: 'Retirement', monthly: 650, current: 3120 }
                    ]
                };
                saveData();
                renderAll();
            }
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Clear all data? This cannot be undone.')) {
                budgetData = {
                    income: [],
                    fixedExpenses: [],
                    variableExpenses: [],
                    savings: []
                };
                saveData();
                renderAll();
            }
        }

        // Initialize app on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // Auto-save every 30 seconds
            setInterval(saveData, 30000);
        });

        // Handle page visibility change to save data
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                saveData();
            }
        });

        // Handle before unload to save data
        window.addEventListener('beforeunload', function() {
            saveData();
        });
    </script>
</body>
</html>
